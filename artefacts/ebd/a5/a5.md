# A5: Relational Schema, validation and schema refinement

This artifact contains the Relational Schema obtained by mapping from the Conceptual Data Model. The Relational Schema includes the relation schema, attributes, domains, primary keys, foreign keys and other integrity rules: UNIQUE, DEFAULT, NOT NULL, CHECK.

## 1. Relational Schema

Relation schemas are specified in the compact notation:

| Relation reference | Relation Compact Notation                                            |
| ------------------ | -------------------------------------------------------------------- |
| R01 | member(<u>id</u>, username **UK** **NN**, fullName **NN**, email **UK** **NN**, password **NN**, bio, profileImage, bannerImage, aura **NN** **DF** = 0) |
| R02 | memberFollow(<u>idMemberFollower</u> → member, <u>idMemberFollows</u> → member) |
| R03 | administrator(<u>id</u> → member) |
| R04 | newsPost(<u>id</u>, title **NN**, body, postDate **NN**, aura **NN**, <u>owner</u> → member) |
| R05 | topic(<u>id</u>, name **UK** **NN**) |
| R06 | topicFollow(<u>idTopic</u> → topic, <u>idMember</u> → member ) |
| R07 | comment(<u>id</u>, body **NN**, commentDate **NN**, <u>idPost</u> → newsPost) |
| R08 | reply(<u>idComment</u> → comment, idParent → comment) |
| R09 | postImages(<u>idPost</u> → newsPost, file **UK** **NN**) |
| R10 | postAura(<u>idPost</u> → newsPost, <u>idMember</u> → member, upvote **NN**) |                  
| R11 | commentAura(<u>idComment</u> → Comment, <u>idMember</u> → member, upvote) |
| R12 | followNotification(<u>idFollower</u> → member, <u>idFollowed</u> → member) |
| R13 | commentNotification(<u>idComment</u> → comment, <u>idMember</u> → member, body **NN**) |
| R14 | postReport(<u>idMember</u> → member, <u>idPost</u> → newsPost, body **NN**) |
| R15 | commentReport(<u>idMember</u> → member, <u>idComment</u> → comment, body **NN**) |
| R16 | topicReport(<u>idMember</u> → member, <u>idTopic</u> → topic, body **NN**) | 
| R17 | memberReport(<u>idReporter</u> → member, <u>idReported</u> → member, body **NN** |

**Note:** UK means UNIQUE KEY, NN means NOT NULL, DF means DEFAULT and CK means CHECK.


## 2. Domains

The specification of additional domains can also be made in a compact form, using the notation:

| Domain Name | Domain Specification |
| ----------- | -------------------- |
| Now | CURRENT_TIMESTAMP() |


## 3. Functional Dependencies and schema validation

To validate the Relational Schema obtained from the Conceptual Model, all functional dependencies are identified and the normalization of all relation schemas is accomplished.

| Table R01  (member)   |    |
| ---- | ---- |
| **Keys** | {id}, {username}, {email} |
| FD0101 | {id}:- {username, fullName ,email, password, bio, profileImage, bannerImage, aura} | 
| FD0102 | {username}:- {id, fullName ,email, password, bio, profileImage, bannerImage, aura} |
| FD0103 | {email}:- {id, username, fullName, password, bio, profileImage, bannerImage, aura} |
| **Normal form** | BCNF |

| Table R02  (memberfollow)   |    |
| ---- | ---- |
| **Keys** | {idMemberFolllows, idMemberFollowed} |
| **Normal form** | BCNF |

| Table R03  (administrator)   |    |
| ---- | ---- |
| **Keys** | {idMember} |
| **Normal form** | BCNF |

| Table R04  (newsPost)   |    |
| ---- | ---- |
| **Keys** | {id} |
| FD0401 | {id}:- {title , body, date , aura , owner} | 
| **Normal form** | BCNF |

| Table R05  (topic)   |    |
| ---- | ---- |
| **Keys** | {id} |
| FD0501 | {id}:- {title , body, date , aura , owner} | 
| **Normal form** | BCNF |

| Table R06  (topicFollow)   |    |
| ---- | ---- |
| **Keys** | {id}, {name} |
| **Normal form** | BCNF |

| Table R07  (comment)   |    |
| ---- | ---- |
| **Keys** | {id} |
| FD0701 | {id}:- {body, commentDate, idPost} | 
| **Normal form** | BCNF |

| Table R08  (reply)   |    |
| ---- | ---- |
| **Keys** | {idComment} |
| FD0801 | {idComment}:- {idParent} | 
| **Normal form** | BCNF |

| Table R09  (postImages)   |    |
| ---- | ---- |
| **Keys** | {idPost}, {file} |
| FD0901 | {idPost}:- {file} | 
| FD0902 | {file}:- {idPost} | 
| **Normal form** | BCNF |

| Table R10  (postAura)   |    |
| ---- | ---- |
| **Keys** | {idPost, idMember} |
| FD1001 | {idPost, idMember}:- {upvote} | 
| **Normal form** | BCNF |

| Table R11  (commentAura)   |    |
| ---- | ---- |
| **Keys** | {idComment, idMember}  |
| FD1101 | {idComment, idMember}:- {upvote} | 
| **Normal form** | BCNF |

| Table R12  (followNotification)   |    |
| ---- | ---- |
| **Keys** | {idFollower, idFollowed} |
| **Normal form** | BCNF |

| Table R13  (commentNotification)   |    |
| ---- | ---- |
| **Keys** | {idComment, idMember} |
| FD0701 | {idComment, idMember}:- {body} | 
| **Normal form** | BCNF |

| Table R14  (postReport)   |    |
| ---- | ---- |
| **Keys** | {idPost, idMember} |
| FD0701 | {idPost, idMember}:- {body} | 
| **Normal form** | BCNF |

| Table R15  (commentReport)   |    |
| ---- | ---- |
| **Keys** | {idComment, idMember} |
| FD0701 | {idComment, idMember}:- {body} | 
| **Normal form** | BCNF |

| Table R16  (topicReport)   |    |
| ---- | ---- |
| **Keys** | {idMember, idTopic} |
| FD1601 | {idMember, idTopic}:- {body} | 
| **Normal form** | BCNF |

| Table R17  (memberReport)   |    |
| ---- | ---- |
| **Keys** | {idReporter, idReported} |
| FD1701 | {idReporter, idReported}:- {body} | 
| **Normal form** | BCNF |


As all relations schemas are in the Boyce–Codd Normal Form (BCNF), the relational schema is also in the BCNF and therefore there is no need to be refined using normalisation.


## 4. SQL Code

```
DROP TABLE IF EXISTS member CASCADE;
DROP TABLE IF EXISTS memberFollow CASCADE;
DROP TABLE IF EXISTS administrator CASCADE;
DROP TABLE IF EXISTS newsPost CASCADE;
DROP TABLE IF EXISTS topic CASCADE;
DROP TABLE IF EXISTS topicFollow CASCADE;
DROP TABLE IF EXISTS comment CASCADE;
DROP TABLE IF EXISTS reply CASCADE;
DROP TABLE IF EXISTS postImages CASCADE;
DROP TABLE IF EXISTS postAura CASCADE;
DROP TABLE IF EXISTS commentAura CASCADE;
DROP TABLE IF EXISTS followNotification CASCADE;
DROP TABLE IF EXISTS commentNotification CASCADE;
DROP TABLE IF EXISTS postReport CASCADE;
DROP TABLE IF EXISTS topicReport CASCADE;
DROP TABLE IF EXISTS memberReport CASCADE;


CREATE TABLE member (
    id integer PRIMARY KEY,
    username text NOT NULL UNIQUE,
    fullName text NOT NULL,
    email text NOT NULL UNIQUE,
    password text NOT NULL,
    bio text,
    profileImage blob,
    bannerImage blob,
    aura integer DEFAULT 0 NOT NULL
);

CREATE TABLE memberFollow (
    idMemberFollower integer REFERENCES member(id) ON DELETE CASCADE,
    idMemberFollows integer REFERENCES member(id) ON DELETE CASCADE,
    PRIMARY KEY(idMemberFollower, idMemberFollows)
);

CREATE TABLE administrator (
    id integer PRIMARY KEY REFERENCES member(id)
);

CREATE TABLE newsPost (
    id integer PRIMARY KEY,
    title text NOT NULL,
    body text,
    postDate timestamp NOT NULL,
    aura integer DEFAULT 0 NOT NULL,
    owner integer NOT NULL REFERENCES member(id) ON DELETE CASCADE,
);

CREATE TABLE topic (
    id integer PRIMARY KEY,
    name text NOT NULL UNQUE
);

CREATE TABLE topicFollow (
    idTopic integer REFERENCES topic(id) ON DELETE CASCADE,
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    PRIMARY KEY(idTopic, idMember)
);

CREATE TABLE comment (
    id integer PRIMARY KEY,
    body text NOT NULL,
    commentDate timestamp NOT NULL,
    aura integer DEFAULT 0 NOT NULL,
    idPost integer NOT NULL REFERENCES newsPost(id) ON DELETE CASCADE
);

CREATE TABLE reply (
    idComment integer REFERENCES comment(id) ON DELETE CASCADE,
    idParent integer REFERENCES comment(id) ON DELETE CASCADE,
    PRIMARY KEY(idComment, idParent)
);

CREATE TABLE postImages (
    idPost integer REFERENCES newsPost(id) ON DELETE CASCADE,
    file blob,
    PRIMARY KEY(idPost, file)
);

CREATE TABLE postAura (
    idPost integer REFERENCES newsPost(id) ON DELETE CASCADE,
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    upvote boolean NOT NULL,
    PRIMARY KEY(idPost, idMember)
);

CREATE TABLE commentAura (
    idComment integer REFERENCES comment(id) ON DELETE CASCADE,
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    upvote boolean NOT NULL,
    PRIMARY KEY(idComment, idMember)
);

CREATE TABLE followNotification (
    idFollower integer REFERENCES member(id) ON DELETE CASCADE,
    idFollowed integer REFERENCES member(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idFollower, idFollowed)
);

CREATE TABLE commentNotification (
    idComment integer REFERENCES comment(id) ON DELETE CASCADE,
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idComment, idMember)
);

CREATE TABLE postReport (
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    idPost integer REFERENCES newsPost(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idMember, idPost)
);

CREATE TABLE commentReport (
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    idComment integer REFERENCES comment(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idMember, idComment)
);

CREATE TABLE topicReport (
    idMember integer REFERENCES member(id) ON DELETE CASCADE,
    idTopic integer REFERENCES topic(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idMember, idTopic)
);

CREATE TABLE memberReport (
    idReporter integer REFERENCES member(id) ON DELETE CASCADE,
    idReported integer REFERENCES member(id) ON DELETE CASCADE,
    body text NOT NULL,
    PRIMARY KEY(idReporter, idReported)
);
```


***
## Revision history

Changes made to the first submission:  N/A

***
GROUP2133, 16/03/2021